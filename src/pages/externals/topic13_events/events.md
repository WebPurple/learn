---
title: События
templateKey: 'article-page'
order: 1
tags: events, DOM, onclick, addEventListener, JavaScript
---
# События

Для реакции на действия посетителя и внутреннего взаимодействия скриптов существуют события.

**Событие** – это сигнал от браузера о том, что что-то произошло.

Существует много видов событий.

DOM-события, которые инициализируются элементами DOM. Например:
    
   - Событие *click* происходит, когда кликнули на элемент;
   - Событие *mouseover* — когда на элемент наводится мышь;
   - Событие *focus* — когда посетитель фокусируется на элементе;
   - Событие *keydown* — когда посетитель нажимает клавишу.

События для окна браузера. Например, *resize* — когда изменяется размер окна.

Есть загрузки файла/документа: *load*, *readystatechange*, *DOMContentLoaded*.

С остальными можно ознакомиться в [cправочнике по событиям](https://developer.mozilla.org/en-US/docs/Web/Events).

События соединяют JavaScript-код с документом и посетителем, позволяя создавать динамические интерфейсы.

## Обработчики событий

При возникновении события система генерирует сигнал, а также предоставляет механизм, 
с помощью которого можно автоматически предпринимать какие-либо действия (например, выполнить определенный код), 
когда происходит событие. 

Назначить **обработчик** означает, что можно в событие передать функцию, которая сработает, как только *событие произошло*.

### Способы использования веб-событий

Существует несколько различных способов, которыми вы можете добавить код прослушивателя событий на веб-страницы, 
чтобы он запускался при возникновении соответствующего события. 

#### Использование атрибута HTML

[События HTML 5](https://schoolsw3.com/tags/ref_eventattributes.php) - это специальные атрибуты, используемые в тегах для вызова обработчиков событий и вызываемых, 
когда на странице происходит какое-либо действие. 

Такой обработчик назначается прямо в разметке, в атрибуте, который называется по имени события;.

Например, чтобы прикрепить click-событие к input-кнопке, можно присвоить обработчик onclick:

```html
<input id="b1" value="Нажми меня" onclick="alert('Спасибо!')" type="button"/>
```
    
При клике мышкой на кнопке выполнится код, указанный в атрибуте onclick.

Обратите внимание, внутри alert используются одиночные кавычки, так как сам атрибут находится в двойных.
В разметке пишутся только очень простые обработчики. 
Если нужно сделать что-то сложное, то имеет смысл описать это в функции, и в обработчике вызвать её.

```html 
<script>
    function countRabbits() {
        for(var i = 1; i <= 3; i++) {
            alert("Кролик номер " + i);
        }
    }
</script>
   
<input type="button" onclick="countRabbits()" value="Считать кроликов!"/>
```

#### Использование DOM-свойств

Осуществляется [поиск элемента в DOM](https://www.w3schools.com/js/js_htmldom_elements.asp) и назначение ему обработчика:

```html 
<input type="button" id="button" value="Считать кроликов"/>
      
<script>
    document.getElementById('button').onclick = function countRabbits() {
        for(var i = 1; i <= 3; i++) {
            alert("Кролик номер " + i);
        }
    }
 </script>
``` 

Первичным является именно свойство, а атрибут — лишь способ его инициализации.
Так как свойство, в итоге, одно, то назначить по обработчику и там и там нельзя.
    
#### Специальные методы

Для назначения обработчиков существуют специальные методы. Как правило, в браузерах они стандартные, кроме IE<9.

Назначение обработчика:

```javascript
element.addEventListener(event, handler, phase);
```

Удаление:
```javascript
element.removeEventListener(event, handler, phase);
```

Внутри функций указываем параметры:

 *event* — имя события, для которого мы хотим зарегистрировать этот обработчик, 
 
  *handler* — код, содержащий функцию обработчика, которую мы хотим запустить в ответ,
  
  *phase* — фаза (обычно не используется и выставлен в false), подробнее ниже в разделе "Фазы события".       
  
  - phase true - событие будет перехвачено по дороге вниз
  
  - phase false - событие будет поймано при всплытии 
    
У **removeEventListener**, есть один нюанс: нужно указать функцию обратного вызова, которая изначально была привязана к событию.     
    
    
Пример использования: 
```javascript
function handler() { // code }
    
elem.addEventListener( "click" , handler, false); // назначение обработчика
    
elem.removeEventListener("click", handler, false); // удаление обработчика
```
    
Особенности специальных методов:

- Можно поставить столько обработчиков, сколько вам нужно.

- Нельзя получить все назначенные обработчики из элемента.

- Браузер не гарантирует сохранение порядка выполнения обработчиков. Они могут быть назначены в одном порядке, а выполниться — в другом.

### Более гибкое добавление обработчиков

В современных браузерах в третьем аргументе addEventListener можно передавать [объект с настройками](https://developer.mozilla.org/ru/docs/Web/API/EventTarget/addEventListener).
   
Добавление обработчика:

```javascript
element.addEventListener(event, handler, options);
```
  
- options.capture - перехват события по дороге вниз

- options.once - обработчик будет вызван только один раз

- options.passive - говорит браузеру, что внутри обработчика не будет вызова preventDefault (об этом ниже, в разделе "Предотвращение обработки событий").
    
 При удалении нужно передать те же аргументы:
 
```javascript
element.removeEventListener(event, handler, options);
```

## Объект события event
Объект event предназначен для получения различной информации о событии в обработчике события. 

То есть позволяет получить элемент, который вызвал обработчик события; элемент, который сгенерировал событие; 
определить какая была нажата кнопка мыши (для событий связанных с мышью) и многое другое.

Объект event всегда передаётся обработчику события через первый параметр.

```javascript
element.addEventListener("click", function(event) {
    //переменная event будет содержать объект event
}, false);
```
    
Общие свойства объекта event:

- type - строка, содержащее имя события.

- target - DOM-элемент, который сгенерировал событие.

- currentTarget - DOM-элемент, который вызвал обработчик события.

- eventPhase - число, показывающее на каком этапе произошло событие (1 - этапе погружения (перехвата), 2 - на цели, 3 - на этапе всплытия).

- timestamp - число (дата), когда произошло событие

- bubbles - возвращает логическое значение, указывающее может ли данное событие всплывать

- defaultPrevented - проверяет можно ли вызвать метод preventDefault() для данного события.

- view - возвращает ссылку на объект window, в котором произошло событие.
  
[Подробнее про интерфейс Event](https://developer.mozilla.org/ru/docs/Web/API/Event).
    
## Распространение событий
### Фазы события

 События могут срабатывать для любой части документа вследствие взаимодействия с ним пользователя или браузера. 
 Они не просто начинаются и заканчиваются в одном месте; они циркулируют по всему документу, 
 проходя свой собственный жизненный цикл. 
 
 Событие движется от корня документа к цели (**фаза перехвата** - Capturing), затем срабатывает для цели события (**фаза цели** - Target) 
 и движется назад к корню документа (**фаза всплытия** - Bubbling).

[Графическое представление события, в дереве DOM с использованием потока событий](https://www.w3.org/TR/DOM-Level-3-Events/#event-flow).

[Пример: замедленное воспроизведение продвижения события](http://jsbin.com/exezex/4/edit?html,css,js,output)

#### Фаза перехвата

Первой фазой является фаза перехвата. Событие начинает своё путешествие в корне документа, проходит каждый слой дерева документа по направлению к цели, срабатывая для каждого узла по пути, пока её не достигнет. 
Задача фазы перехвата — наметить траекторию распространения, по которой событие будет двигаться в обратном направлении в фазе всплытия.
    
Обработчик можно вызвать в фазе перехвата, если в качестве третьего параметра для **addEventListener** указать **true**. 

```javascript    
var form = document.querySelector('form');
    
form.addEventListener('click', function(event) {
    event.stopPropagation();
}, true); 
```
    
Для вызова обработчика события в фазе всплытия, указывается последним параметром значение false или undefined.

#### Фаза цели

Момент, когда событие достигает конечного объекта, известен как фаза цели. 
Самый глубокий элемент, который вызывает событие, называется **целевым** или **исходным** элементом.

Событие срабатывает для целевого узла перед тем, как изменить направление своего продвижения и вернуться назад к самому внешнему уровню документа.
    
В случае с вложенными элементами, события мыши и указателя мыши всегда нацелены на наиболее глубоко расположенный вложенный элемент. 

Если обработчик вызывается для события click элемента <div>, и пользователь кликает по элементу <p> внутри <div>, этот <p> становится целью события. Тот факт, что события «всплывают» значит, что можно вызывать обработчик для кликов по <div> (или любому другому родительскому элементу) и получать функцию обратного вызова при прохождении события.

### Всплытие

Основной принцип всплытия: после того, как событие сработало для цели, оно на этом *не останавливается*. 

Оно всплывает наверх (или же распространяется) по дереву документа, пока не достигнет его корня. Это значит, что то же самое событие срабатывает для родительского узла целевого элемента, затем для его родительского узла, и это продолжается пока не остаётся родительских элементов, для которых может сработать событие.

Всплытие события — это очень полезное явление. Оно делает необязательным установку обработчика события для конкретного элемента,  для которого происходит событие, вместо этого мы можем установить обработчик для элемента выше по дереву документа и подождать пока событие его достигнет. 

Это один из важных приёмов разработки – [делегирование](https://learn.javascript.ru/event-delegation).

### Предотвращение обработки событий

Всплытие идет прямо наверх. Обычно оно будет всплывать до HTML , а затем до document, вызывая все обработчики на своем пути.

Но любой промежуточный обработчик может решить, что событие полностью обработано, и остановить всплытие.

Чтобы остановить всплытие, можно использовать методы объекта event:

- **event.preventDefault()** - предотвращает поведение по умолчанию. Например, переход по ссылке.

- **event.stopPropagation()** - предотвращает всплывание события (все обработчики на этом элементе выполнятся), 
останавливает обработку событий на текущем элементе (все остальные обработчики на этом элементе не выполнятся)

- **event.stopImmediatePropagation()** - Для конкретного события не будет больше вызвано обработчиков. 
Ни тех, которые привязаны к этому же элементу (на котором работает обработчик, который вызывает этот Event.stopImmediatePropagation()), 
ни других, которые могли бы вызваться при распространении события позже (например, в фазе перехвата - capture).

## Дополнительные материалы:

[Введение в события](https://developer.mozilla.org/ru/docs/Learn/JavaScript/Building_blocks/%D0%A1%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D1%8F)

[Введение в события](http://learn.javascript.ru/introduction-browser-events)

[Справочник по событиям](https://developer.mozilla.org/en-US/docs/Web/Events)

[События event-flow](https://www.w3.org/TR/DOM-Level-3-Events/#event-flow) 

[Отличие preventDefault, stopPropagation и stopImmediatePropagation](http://stepansuvorov.com/blog/2013/05/%D0%BE%D1%82%D0%BB%D0%B8%D1%87%D0%B8%D0%B5-preventdefault-stoppropagation-%D0%B8-stopimmediatepropagation/)

[Генерация пользовательских событий](https://learn.javascript.ru/dispatch-events)

[Жизненный цикл HTML-страницы](https://learn.javascript.ru/onload-ondomcontentloaded)
